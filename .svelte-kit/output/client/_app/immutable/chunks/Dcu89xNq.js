import{s as a}from"./DxmBqDFk.js";const c=!0;function m(n){return function(...r){var e=r[0];return e.preventDefault(),n?.apply(this,r)}}const p=c;async function g(n){const{email:r,username:e,language:u}=n;if(!r)return{error:new Error("Missing email")};try{const{data:t,error:o}=await a.from("profiles").select("id, username").eq("email",r).single();if(o||!t?.id)return console.error("Profile not found for update:",o?.message||"No profile"),{error:o||new Error("Profile not found")};if(e&&e!==t.username){const{data:l,error:f}=await a.from("profiles").select("id").eq("username",e).neq("id",t.id).limit(1);if(f)return console.error("Error checking username availability:",f),{error:new Error("Could not check username availability")};if(l&&l.length>0)return{error:new Error("USERNAME_TAKEN")}}const i={};if(e&&(i.username=e),u&&(i.language=u),Object.keys(i).length===0)return{error:null};const{error:s}=await a.from("profiles").update(i).eq("id",t.id);return s?s.message.includes("profiles_username_unique")?{error:new Error("USERNAME_TAKEN")}:{error:s}:{error:null}}catch(t){return console.error("Update profile settings failed:",t),{error:t}}}async function E(n){if(!n)return{data:null,error:new Error("Missing email")};try{const{data:r,error:e}=await a.from("profiles").select("id, email, username, language, payment_received").eq("email",n).limit(1).maybeSingle();return{data:r,error:e}}catch(r){return{data:null,error:r}}}async function y(){try{const{data:{user:n}}=await a.auth.getUser();return!!n?.id}catch{return!1}}export{p as b,E as g,y as i,m as p,g as u};
