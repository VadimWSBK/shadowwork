import"../chunks/DsnmJJEf.js";import{i as K}from"../chunks/VjwJ5DFS.js";import{o as Q,a as V,s as M,e as W}from"../chunks/4tzv8gyV.js";import{p as X,b as _,a as y,d as Y,e as r,m as h,g as n,h as c,i as a,r as d,t as S}from"../chunks/CBH2oh36.js";import{i as C}from"../chunks/TFLlWf41.js";import{r as N}from"../chunks/fbDB8B4R.js";import{b as B}from"../chunks/CY7Vc3nc.js";import{g as Z}from"../chunks/KHq5D6Xm.js";import{s as l}from"../chunks/DxmBqDFk.js";var $=_('<p class="text-sm text-red-300 mb-6"> </p>'),ee=_('<p class="mt-2 text-sm text-red-300"> </p>'),te=_('<p class="mt-2 text-sm text-green-300"> </p>'),ae=_('<form class="space-y-6"><div><label for="new-password" class="block text-sm font-medium text-white/80 mb-2">New password</label> <input id="new-password" type="password" placeholder="••••••••" class="w-full px-4 py-3 leading-relaxed text-white placeholder-white/60 bg-white/20 border border-white/30 rounded focus:outline-none focus:ring-2 focus:ring-[#0C6E78] focus:border-[#0C6E78] transition-all duration-200 shadow-inner backdrop-blur-sm"/></div> <div><label for="confirm-password" class="block text-sm font-medium text-white/80 mb-2">Confirm password</label> <input id="confirm-password" type="password" placeholder="••••••••" class="w-full px-4 py-3 leading-relaxed text-white placeholder-white/60 bg-white/20 border border-white/30 rounded focus:outline-none focus:ring-2 focus:ring-[#0C6E78] focus:border-[#0C6E78] transition-all duration-200 shadow-inner backdrop-blur-sm"/></div> <!> <!> <button type="submit" class="w-full px-6 py-3 text-sm font-bold text-white rounded shadow-md transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed relative overflow-hidden group border" style="background: linear-gradient(135deg, #0C6E78 0%, #0A5A63 100%); border-image: linear-gradient(135deg, #D4AF37 0%, #B8860B 100%) 1;"><div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div> <span class="relative z-10">Update password</span></button></form>'),re=_('<div class="min-h-screen bg-gradient-to-br from-primary-light via-primary to-secondary-dark flex items-center justify-center py-8 px-4 sm:px-6 lg:px-8"><div class="w-full max-w-md"><div class="p-8"><h1 class="text-2xl font-bold text-white mb-4">Reset your password</h1> <!> <!></div></div></div>');function he(F,J){X(J,!1);let m=h(""),E=h(""),i=h(""),x=h(""),U=h(!1),k=h(!1),R,T=h(!0);Q(async()=>{setTimeout(()=>{r(T,!1)},500);try{R=l.auth.onAuthStateChange(async(t,e)=>{if(e){try{await fetch("/auth/cookie",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({access_token:e.access_token,refresh_token:e.refresh_token})})}catch{}r(k,!0)}})}catch{}try{const t=new URLSearchParams(window.location.search),e=new URLSearchParams(window.location.hash.replace(/^#/,"")),p=t.get("code"),w=t.get("token_hash")||t.get("token")||t.get("hash")||e.get("token_hash")||e.get("token")||e.get("hash"),v=t.get("type")||e.get("type")||"recovery",g=e.get("access_token"),b=e.get("refresh_token");let f=!1;if(w){const{error:o}=await l.auth.verifyOtp({token_hash:w,type:v});if(o)throw o;f=!0}else if(p){const{error:o}=await l.auth.exchangeCodeForSession(window.location.search);if(o)throw o;f=!0}else if(g&&b){const{error:o}=await l.auth.setSession({access_token:g,refresh_token:b});if(o)throw o;f=!0}const{data:{user:P}}=await l.auth.getUser();if(!f&&!P)throw new Error("Missing or invalid reset parameters")}catch{r(i,"Invalid or expired reset link. Please request a new one.");return}try{const{data:{user:t}}=await l.auth.getUser();if(t){const{data:{session:e}}=await l.auth.getSession();e&&await fetch("/auth/cookie",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({access_token:e.access_token,refresh_token:e.refresh_token})})}}catch{}r(k,!0)}),V(()=>{try{R?.data?.subscription?.unsubscribe?.()}catch{}});async function q(t){if(t.preventDefault(),r(i,""),r(x,""),a(m).length<8){r(i,"Password must be at least 8 characters.");return}if(a(m)!==a(E)){r(i,"Passwords do not match.");return}r(U,!0);const{error:e}=await l.auth.updateUser({password:a(m)});if(r(U,!1),e){r(i,"Could not update password. Please try again.");return}r(x,"Password updated successfully."),setTimeout(()=>Z("/login"),1e3)}K();var O=re(),j=n(O),D=n(j),L=c(n(D),2);{var z=t=>{var e=$(),p=n(e,!0);d(e),S(()=>M(p,a(i))),y(t,e)};C(L,t=>{a(i)&&!a(k)&&!a(T)&&t(z)})}var I=c(L,2);{var G=t=>{var e=ae(),p=n(e),w=c(n(p),2);N(w),d(p);var v=c(p,2),g=c(n(v),2);N(g),d(v);var b=c(v,2);{var f=s=>{var u=ee(),A=n(u,!0);d(u),S(()=>M(A,a(i))),y(s,u)};C(b,s=>{a(i)&&s(f)})}var P=c(b,2);{var o=s=>{var u=te(),A=n(u,!0);d(u),S(()=>M(A,a(x))),y(s,u)};C(P,s=>{a(x)&&s(o)})}var H=c(P,2);d(e),S(()=>H.disabled=a(U)),B(w,()=>a(m),s=>r(m,s)),B(g,()=>a(E),s=>r(E,s)),W("submit",e,q),y(t,e)};C(I,t=>{a(k)&&t(G)})}d(D),d(j),d(O),y(F,O),Y()}export{he as component};
