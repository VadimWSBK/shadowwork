import"../chunks/DsnmJJEf.js";import{i as $e}from"../chunks/VjwJ5DFS.js";import{o as ze,a as Fe,e as E,s as v}from"../chunks/4tzv8gyV.js";import{p as Ne,b as k,t as M,a as _,d as qe,i as e,m as g,g as r,h as n,e as i,r as s,f as Ge,v as Je}from"../chunks/CBH2oh36.js";import{i as I}from"../chunks/TFLlWf41.js";import{s as T,r as Y}from"../chunks/fbDB8B4R.js";import{s as Z}from"../chunks/v6OzXV5o.js";import{b as ee}from"../chunks/CY7Vc3nc.js";import{b as ue,p as Ke,u as Ve}from"../chunks/Dcu89xNq.js";import{s as b}from"../chunks/DxmBqDFk.js";import{g as He}from"../chunks/KHq5D6Xm.js";import{t as c}from"../chunks/BlvcK136.js";var Qe=k('<div class="absolute right-0 mt-2 min-w-[9rem] max-w-[90vw] bg-white/15 rounded shadow-lg backdrop-blur-md p-1"><button>English</button> <button>Deutsch</button> <button>Polski</button></div>'),We=k('<div class="text-white/80 text-sm">Validating invite linkâ€¦</div>'),Xe=k('<p class="text-sm text-red-300"> </p>'),Ye=k('<p class="text-sm text-green-300"> </p>'),Ze=Je('<svg class="w-4 h-4 animate-spin text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="10" stroke-width="2" opacity="0.25"></circle><path d="M12 2a10 10 0 0 1 10 10" stroke-width="2" opacity="0.75"></path></svg>'),et=k('<!> <!> <div><label class="block text-sm font-medium text-white/80 mb-2"> </label> <input type="text" class="w-full px-4 py-3 leading-relaxed text-white placeholder-white/60 bg-white/20 rounded focus:outline-none transition-all duration-200 shadow-inner backdrop-blur-sm"/></div> <div><label class="block text-sm font-medium text-white/80 mb-2"> </label> <input type="password" autocomplete="new-password" class="w-full px-4 py-3 leading-relaxed text-white placeholder-white/60 bg-white/20 rounded focus:outline-none transition-all duration-200 shadow-inner backdrop-blur-sm"/> <p class="mt-1 text-xs text-white/60"> </p></div> <div><label class="block text-sm font-medium text-white/80 mb-2"> </label> <input type="password" autocomplete="new-password" class="w-full px-4 py-3 leading-relaxed text-white placeholder-white/60 bg-white/20 rounded focus:outline-none transition-all duration-200 shadow-inner backdrop-blur-sm"/></div> <button class="w-full px-6 py-3 text-sm font-bold text-white rounded shadow-md transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed relative overflow-hidden group flex items-center justify-center gap-2 border" style="background: linear-gradient(135deg, #0C6E78 0%, #0A5A63 100%); border-image: linear-gradient(135deg, #D4AF37 0%, #B8860B 100%) 1;"><div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div> <!> <span class="relative z-10"> </span></button>',1),tt=k('<div class="signup-page min-h-screen bg-gradient-to-br from-primary-light via-primary to-secondary-dark flex items-center justify-center py-8 px-4 sm:px-6 lg:px-8"><div class="fixed top-4 right-4 z-50"><div class="relative"><button class="inline-flex items-center px-2.5 py-1 text-xs font-semibold rounded bg-white/15 text-white/90 hover:bg-white/20 transition-colors focus:outline-none" aria-haspopup="menu" title="Change language"><span class="text-xs font-semibold tracking-wide"> </span></button> <!></div></div> <div class="w-full max-w-md"><div class="p-8"><div class="text-center mb-8"><div class="w-16 h-16 bg-white/20 border border-white/30 rounded mx-auto mb-4 flex items-center justify-center shadow-md backdrop-blur-sm"><svg class="w-8 h-8 text-white/90" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg></div> <h1 class="text-2xl font-bold text-white mb-1"> </h1> <h2 class="text-3xl font-bold text-white mb-2"> </h2> <p class="text-white/80"> </p></div> <form class="space-y-6"><!></form> <div class="mt-8 pt-6 border-t border-white/20"><p class="text-xs text-white/70 text-center leading-relaxed"> </p></div></div></div></div>');function vt(pe,he){Ne(he,!1);let O=g(!1),S=g(!1),f=g(""),D=g(""),P=g(""),C=g(""),$=g(""),ve=null,o=g("en"),x=g(!1);const me="shadowwork_language";function ge(t){try{const p=new Date(Date.now()+63072e6).toUTCString(),h=typeof window<"u"&&window.location.protocol==="https:"?"; Secure":"";document.cookie=`${me}=${encodeURIComponent(t)}; Expires=${p}; Path=/; SameSite=Lax${h}`}catch{}}function fe(){try{const t=document.cookie.match(/(?:^|;\s*)shadowwork_language=([^;]+)/),a=t?decodeURIComponent(t[1]):null;return a==="en"||a==="de"||a==="pl"?a:null}catch{return null}}function z(t){i(o,t);try{ue&&(localStorage.setItem("shadowwork_language",t),ge(t),document.documentElement.lang=t)}catch{}}ze(async()=>{try{let t=null;ue&&(t=fe()??localStorage.getItem("shadowwork_language")),(t==="en"||t==="de"||t==="pl")&&i(o,t)}catch{}try{if(typeof window<"u"){const t=new URLSearchParams(window.location.search),a=new URLSearchParams(window.location.hash.slice(1)),p=t.get("token_hash"),h=t.get("code"),u=t.get("type")||a.get("type")||"invite",R=a.get("access_token"),y=a.get("refresh_token");let w=!1;if(p){console.log("Processing token_hash invite...");const{error:d}=await b.auth.verifyOtp({token_hash:p,type:u});if(d)throw d;w=!0}else if(h){console.log("Processing code invite...");const{error:d}=await b.auth.exchangeCodeForSession(window.location.search);if(d)throw d;w=!0}else if(R&&y){console.log("Processing access_token invite...");const{error:d}=await b.auth.setSession({access_token:R,refresh_token:y});if(d)throw d;w=!0}const{data:{user:A}}=await b.auth.getUser();if(!w&&!A)throw new Error("Missing or invalid invite parameters");console.log("Invite processed successfully, user:",A?.email);try{const{data:{session:d}}=await b.auth.getSession();d&&(await fetch("/auth/cookie",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({access_token:d.access_token,refresh_token:d.refresh_token})}),console.log("Server cookies set successfully"))}catch(d){console.warn("Failed to set server cookies:",d)}try{window.history.replaceState({},document.title,"/signup")}catch{}}i(O,!0)}catch(t){console.error("Invite processing error:",t),i(f,c(e(o),"signup.invalidInvite")),i(O,!0)}}),Fe(()=>{try{ve?.data?.subscription?.unsubscribe?.()}catch{}});async function we(t){if(t.preventDefault(),i(f,""),i(D,""),!e(P)||e(P).trim().length<2){i(f,c(e(o),"signup.usernameRequired"));return}if(e(C).length<8){i(f,c(e(o),"signup.passwordTooShort"));return}if(e(C)!==e($)){i(f,c(e(o),"signup.passwordsMismatch"));return}i(S,!0);try{const{error:a}=await b.auth.updateUser({password:e(C)});if(a)throw a;const{data:{user:p}}=await b.auth.getUser(),h=p?.email;if(h){const{error:u}=await Ve({email:h,username:e(P),language:"en"});u&&console.warn("Profile update failed:",u.message)}i(D,c(e(o),"signup.success"));try{const{data:{session:u}}=await b.auth.getSession();u&&await fetch("/auth/cookie",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({access_token:u.access_token,refresh_token:u.refresh_token})})}catch{}setTimeout(()=>He("/dashboard"),800)}catch(a){i(f,a?.message||c(e(o),"signup.setupFailed"))}finally{i(S,!1)}}$e();var F=tt(),N=r(F),te=r(N),L=r(te),ae=r(L),be=r(ae,!0);s(ae),s(L);var xe=n(L,2);{var _e=t=>{var a=Qe(),p=r(a),h=n(p,2),u=n(h,2);s(a),M(()=>{Z(p,1,`w-full text-left px-3 py-2 text-sm rounded hover:bg-white/20 text-white ${e(o)==="en"?"bg-white/10":""}`),Z(h,1,`w-full text-left px-3 py-2 text-sm rounded hover:bg-white/20 text-white ${e(o)==="de"?"bg-white/10":""}`),Z(u,1,`w-full text-left px-3 py-2 text-sm rounded hover:bg-white/20 text-white ${e(o)==="pl"?"bg-white/10":""}`)}),E("click",p,()=>{z("en"),i(x,!1)}),E("click",h,()=>{z("de"),i(x,!1)}),E("click",u,()=>{z("pl"),i(x,!1)}),_(t,a)};I(xe,t=>{e(x)&&t(_e)})}s(te),s(N);var re=n(N,2),se=r(re),q=r(se),G=n(r(q),2),ye=r(G,!0);s(G);var J=n(G,2),ke=r(J,!0);s(J);var oe=n(J,2),Se=r(oe,!0);s(oe),s(q);var j=n(q,2),Pe=r(j);{var Ce=t=>{var a=We();_(t,a)},Le=t=>{var a=et(),p=Ge(a);{var h=l=>{var m=Xe(),U=r(m,!0);s(m),M(()=>v(U,e(f))),_(l,m)};I(p,l=>{e(f)&&l(h)})}var u=n(p,2);{var R=l=>{var m=Ye(),U=r(m,!0);s(m),M(()=>v(U,e(D))),_(l,m)};I(u,l=>{e(D)&&l(R)})}var y=n(u,2),w=r(y),A=r(w,!0);s(w);var d=n(w,2);Y(d),s(y);var K=n(y,2),V=r(K),Ee=r(V,!0);s(V);var B=n(V,2);Y(B);var le=n(B,2),Me=r(le,!0);s(le),s(K);var H=n(K,2),Q=r(H),Ie=r(Q,!0);s(Q);var W=n(Q,2);Y(W),s(H);var X=n(H,2),ce=n(r(X),2);{var Oe=l=>{var m=Ze();_(l,m)};I(ce,l=>{e(S)&&l(Oe)})}var de=n(ce,2),De=r(de,!0);s(de),s(X),M((l,m,U,je,Re,Ae,Be,Te)=>{v(A,l),T(d,"placeholder",m),v(Ee,U),T(B,"placeholder",je),v(Me,Re),v(Ie,Ae),T(W,"placeholder",Be),X.disabled=!e(O)||e(S),v(De,Te)},[()=>c(e(o),"signup.usernameLabel"),()=>c(e(o),"signup.usernamePlaceholder"),()=>c(e(o),"signup.passwordLabel"),()=>c(e(o),"signup.passwordPlaceholder"),()=>c(e(o),"signup.passwordRequirement"),()=>c(e(o),"signup.confirmPasswordLabel"),()=>c(e(o),"signup.confirmPasswordPlaceholder"),()=>e(S)?c(e(o),"signup.settingUp"):c(e(o),"signup.finishButton")]),ee(d,()=>e(P),l=>i(P,l)),ee(B,()=>e(C),l=>i(C,l)),ee(W,()=>e($),l=>i($,l)),_(t,a)};I(Pe,t=>{e(O)?t(Le,!1):t(Ce)})}s(j);var ie=n(j,2),ne=r(ie),Ue=r(ne,!0);s(ne),s(ie),s(se),s(re),s(F),M((t,a,p,h,u)=>{T(L,"aria-expanded",e(x)),v(be,t),v(ye,a),v(ke,p),v(Se,h),v(Ue,u)},[()=>e(o).toUpperCase(),()=>c(e(o),"login.title"),()=>c(e(o),"signup.title"),()=>c(e(o),"signup.subtitle"),()=>c(e(o),"signup.disclaimer")]),E("click",L,()=>i(x,!e(x))),E("submit",j,Ke(we)),_(pe,F),qe()}export{vt as component};
