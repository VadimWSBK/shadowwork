import"../chunks/DsnmJJEf.js";import{i as C}from"../chunks/VjwJ5DFS.js";import{o as L,a as O,s as P}from"../chunks/4tzv8gyV.js";import{p as R,c as V,f as j,a as f,d as U,e as o,m as u,i as g,b as y,g as c,h as I,r as d,t as J}from"../chunks/CBH2oh36.js";import{i as M}from"../chunks/TFLlWf41.js";import{L as N}from"../chunks/Bm_DpjIr.js";import{s}from"../chunks/DxmBqDFk.js";import{g as p}from"../chunks/KHq5D6Xm.js";import{b as T}from"../chunks/Dcu89xNq.js";var z=y('<div class="fixed inset-0 z-50 min-h-screen bg-gradient-to-br from-primary-light via-primary to-secondary-dark flex items-center justify-center"><div class="flex items-center gap-3 text-white/90"><span class="inline-block w-5 h-5 rounded border-2 border-white/40 border-t-white animate-spin"></span> <span class="text-sm"> </span></div></div>'),A=y('<div class="login-page"><!></div>');function W(v,_){R(_,!1);let l=null,h="en",r=u(!1),n=u("Verifying login…");function k(){try{const t=document.cookie.match(/(?:^|;\s*)shadowwork_language=([^;]+)/),e=t?decodeURIComponent(t[1]):null;return e==="en"||e==="de"||e==="pl"?e:null}catch{return null}}L(async()=>{try{let e=null;T&&(e=k()??localStorage.getItem("shadowwork_language")),(e==="en"||e==="de"||e==="pl")&&(h=e,typeof document<"u"&&(document.documentElement.lang=h))}catch{}try{if(typeof window<"u"){const e=new URLSearchParams(window.location.search);if(e.get("code"))o(r,!0),o(n,"Verifying magic link…"),await s.auth.exchangeCodeForSession(window.location.search);else if(e.get("token_hash")){o(r,!0),o(n,"Verifying magic link…");const a=e.get("token_hash"),i=e.get("type")||"email";await s.auth.verifyOtp({token_hash:a,type:i})}}}catch{}const{data:{user:t}}=await s.auth.getUser();if(t){o(r,!0),o(n,"Redirecting to dashboard…");const{data:{session:e}}=await s.auth.getSession();if(!e){o(r,!1);return}try{await fetch("/auth/cookie",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({access_token:e.access_token,refresh_token:e.refresh_token})})}catch{}p("/dashboard")}try{l=s.auth.onAuthStateChange(async(e,a)=>{if(a){o(r,!0),o(n,"Syncing session…");try{await fetch("/auth/cookie",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({access_token:a.access_token,refresh_token:a.refresh_token})})}catch{}o(n,"Redirecting to dashboard…"),p("/dashboard")}})}catch{}}),O(()=>{try{l?.data?.subscription?.unsubscribe?.()}catch{}}),C();var m=V(),b=j(m);{var w=t=>{var e=z(),a=c(e),i=I(c(a),2),x=c(i,!0);d(i),d(a),d(e),J(()=>P(x,g(n))),f(t,e)},S=t=>{var e=A(),a=c(e);N(a,{}),d(e),f(t,e)};M(b,t=>{g(r)?t(w):t(S,!1)})}f(v,m),U()}export{W as component};
