<!DOCTYPE html>
<html>
<head>
    <title>Debug User Deletion</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Debug User Deletion</h1>
    <div id="status"></div>
    <button onclick="testDeletion()">Test Deletion</button>
    
    <script>
        // Replace with your actual Supabase URL and anon key
        const supabaseUrl = 'https://gaafkvyzvchroojmvjdu.supabase.co';
        const supabaseKey = 'YOUR_ANON_KEY_HERE'; // You'll need to get this from your .env file
        
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
        
        async function testDeletion() {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = 'Testing deletion...';
            
            try {
                // Get current session
                const { data: { session }, error: sessionError } = await supabase.auth.getSession();
                
                if (sessionError) {
                    statusDiv.innerHTML = `Session error: ${sessionError.message}`;
                    return;
                }
                
                if (!session) {
                    statusDiv.innerHTML = 'No active session. Please log in first.';
                    return;
                }
                
                statusDiv.innerHTML = `Current user: ${session.user.email}<br>`;
                
                // Test the delete-profile function
                const { data, error } = await supabase.functions.invoke('delete-profile', {
                    headers: {
                        'Authorization': `Bearer ${session.access_token}`,
                        'apikey': supabaseKey
                    }
                });
                
                if (error) {
                    statusDiv.innerHTML += `Function error: ${JSON.stringify(error, null, 2)}`;
                } else {
                    statusDiv.innerHTML += `Function result: ${JSON.stringify(data, null, 2)}`;
                }
                
            } catch (e) {
                statusDiv.innerHTML += `Exception: ${e.message}`;
            }
        }
    </script>
</body>
</html>
